<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creador de Carta de Presentación | CV Studio33</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Merriweather:wght@300;400;700&family=Montserrat:wght@400;500;600;700;800&family=Open+Sans:wght@400;600&family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0f172a',
                        secondary: '#3b82f6',
                        accent: '#6366f1',
                        dark: '#020617',
                        paper: '#ffffff',
                    },
                    fontFamily: {
                        sans: ['Open Sans', 'sans-serif'],
                        heading: ['Montserrat', 'sans-serif'],
                    },
                    screens: {
                        'print': {'raw': 'print'},
                    }
                }
            }
        }
    </script>

    <style>
        /* Estilos Base y Scrollbar */
        body {
            background-color: #0f172a;
            color: white;
            font-family: 'Open Sans', sans-serif;
            overflow-x: hidden;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 4px; }

        /* Panel Editor */
        .editor-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            height: calc(100vh - 80px); 
            overflow-y: auto;
        }

        /* --- ESTILOS DE LA CARTA (GURRETT BUTLER) --- */
        .hoja-a4 {
            width: 210mm;
            height: 297mm; /* Altura exacta A4 */
            background-color: white;
            padding: 15mm 20mm;
            box-sizing: border-box;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            position: relative;
            display: flex;
            flex-direction: column;
            color: #000;
            font-family: Arial, Helvetica, sans-serif;
            margin: 0 auto;
            transform-origin: top center;
            transition: transform 0.3s ease;
        }

        /* ENCABEZADO CARTA */
        .letter-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            padding-top: 10px;
        }

        .header-name {
            font-size: 28pt;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: -1px;
            color: #000;
            width: 50%;
            line-height: 0.9;
        }

        .header-contact {
            width: 45%;
            font-size: 8pt;
            display: flex;
            justify-content: flex-start;
            gap: 20px;
        }

        .contact-col {
            display: flex;
            flex-direction: column;
        }

        .label {
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 2px;
            margin-top: 10px;
            font-size: 7pt;
            color: #333;
        }
        .label:first-child { margin-top: 0; }

        .value {
            text-transform: uppercase;
            font-weight: 600;
            line-height: 1.3;
        }

        /* LÍNEA SEPARADORA */
        .letter-hr {
            border: 0;
            border-top: 2px solid black;
            margin-top: 5px;
            margin-bottom: 40px;
        }

        /* INFORMACIÓN DEL DESTINATARIO */
        .recipient-info {
            font-size: 10pt;
            line-height: 1.4;
            margin-bottom: 30px;
            font-weight: 500;
        }

        .recipient-info strong {
            font-weight: bold;
            display: block;
            text-transform: uppercase;
        }

        /* FECHA Y SALUDO */
        .letter-date {
            font-size: 10pt;
            margin-bottom: 25px;
        }

        .salutation {
            font-size: 10pt;
            margin-bottom: 20px;
        }

        /* CUERPO DEL TEXTO */
        .letter-content {
            font-size: 9.5pt;
            line-height: 1.5;
            text-align: justify;
            color: #1a1a1a;
            white-space: pre-wrap; /* Mantiene saltos de línea del textarea */
        }

        .letter-content p {
            margin-bottom: 15px;
        }

        /* FIRMA */
        .closing {
            margin-top: 30px;
            font-size: 10pt;
            margin-bottom: 35px;
        }

        .signature {
            font-size: 10pt;
            font-weight: bold;
        }

        /* PIE DE PÁGINA */
        .letter-footer {
            margin-top: auto;
            display: flex;
            justify-content: space-between;
            font-size: 9pt;
            font-weight: bold;
            padding-bottom: 10px;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }

        /* --- UI EDITOR --- */
        .cv-input, .cv-select {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 10px;
            border-radius: 8px;
            width: 100%;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        .cv-input:focus, .cv-select:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }
        
        .cv-label {
            display: block;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #94a3b8;
            margin-bottom: 4px;
            font-weight: 600;
            margin-top: 10px;
        }

        /* Sliders de Configuración */
        .config-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            outline: none;
        }
        .config-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            transition: background .15s ease-in-out;
        }
        .config-slider::-webkit-slider-thumb:hover { background: #60a5fa; }

        .accordion-header { cursor: pointer; transition: background 0.3s; }
        .accordion-header:hover { background: rgba(255,255,255,0.05); }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-out; }
        .accordion-content.active { max-height: 2000px; }

        /* Loading IA */
        .ai-loading { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Warning text helper */
        .warning-text { font-size: 0.65rem; color: #fbbf24; margin-top: 2px; font-style: italic; }

        /* Modal Móvil */
        .mobile-preview-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100; overflow-y: auto; display: none;
        }
        .mobile-preview-modal.active { display: block; }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">

    <nav class="bg-primary/90 backdrop-blur-md border-b border-white/10 h-20 flex-shrink-0 z-50 relative no-print">
        <div class="container mx-auto px-4 h-full flex justify-between items-center">
            <div class="flex items-center gap-4">
                <a href="Selecionatuforma.html" class="flex items-center gap-2 text-gray-300 hover:text-white transition">
                    <i class="fa-solid fa-arrow-left"></i> <span class="hidden sm:inline">Volver</span>
                </a>
                <a href="Biblioteca-de-cartas.html" class="bg-purple-600/20 border border-purple-500 text-purple-300 px-3 py-1 rounded-full text-xs font-bold hover:bg-purple-600 hover:text-white transition flex items-center gap-2">
                    <i class="fa-solid fa-envelope-open-text"></i> Biblioteca de Cartas
                </a>
            </div>
            
            <div class="flex items-center gap-2 hidden md:flex">
                <span class="font-heading font-bold text-lg">CREADOR DE CARTA</span>
                <span class="text-xs text-gray-500 bg-gray-800 px-2 py-1 rounded">Plantilla: Gurrett Butler</span>
            </div>

            <div class="flex gap-3">
                <button onclick="downloadPDFDirect()" class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg font-bold text-sm transition flex items-center gap-2 shadow-lg shadow-green-900/50">
                    <i class="fa-solid fa-file-pdf"></i> <span class="hidden sm:inline">Descargar PDF</span>
                </button>
            </div>
        </div>
    </nav>

    <div class="flex flex-1 overflow-hidden relative">
        
        <div class="w-full md:w-1/2 lg:w-5/12 editor-panel p-6 pb-32 no-print custom-scrollbar">
            
            <div class="mb-6 bg-blue-900/20 border border-blue-500/30 p-4 rounded-lg">
                <h2 class="text-xl font-bold text-blue-400 mb-1">Editor de Carta</h2>
                <p class="text-xs text-gray-400">Personaliza el contenido de tu carta de presentación.</p>
            </div>

            <div class="mb-4 border border-white/10 rounded-lg overflow-hidden bg-black/20">
                <div class="accordion-header bg-white/5 p-4 flex justify-between items-center" onclick="toggleAccordion('acc-design')">
                    <h3 class="font-bold flex items-center gap-2 text-sm uppercase"><i class="fa-solid fa-paintbrush text-pink-400"></i> Ajustes de Diseño</h3>
                    <i class="fa-solid fa-chevron-down text-xs"></i>
                </div>
                <div id="acc-design" class="accordion-content active p-4">
                    <label class="cv-label">Tipo de Letra del Encabezado</label>
                    <select class="cv-select mb-2" id="font-header" onchange="updateDesign()">
                        <option value="'Montserrat', sans-serif">Montserrat (Negrita)</option>
                        <option value="'Playfair Display', serif">Playfair Display (Elegante)</option>
                        <option value="'Roboto', sans-serif">Roboto (Moderno)</option>
                        <option value="'Open Sans', sans-serif">Open Sans (Limpio)</option>
                        <option value="'Lato', sans-serif">Lato (Profesional)</option>
                    </select>

                    <label class="cv-label">Tipo de Letra del Cuerpo</label>
                    <select class="cv-select mb-2" id="font-body" onchange="updateDesign()">
                        <option value="Arial, Helvetica, sans-serif">Arial (Estándar)</option>
                        <option value="'Open Sans', sans-serif">Open Sans</option>
                        <option value="'Merriweather', serif">Merriweather (Serif)</option>
                        <option value="'Roboto', sans-serif">Roboto</option>
                        <option value="'Lato', sans-serif">Lato</option>
                    </select>

                    <label class="cv-label">Dimensión de Letra (Cuerpo)</label>
                    <div class="flex items-center gap-2">
                        <input type="range" id="font-size-body" class="config-slider" min="8" max="14" step="0.5" value="9.5" oninput="updateDesign()">
                        <span id="font-size-val" class="text-xs text-gray-400 w-8">9.5pt</span>
                    </div>
                </div>
            </div>

            <div class="mb-4 border border-white/10 rounded-lg overflow-hidden bg-black/20">
                <div class="accordion-header bg-white/5 p-4 flex justify-between items-center" onclick="toggleAccordion('acc-personal')">
                    <h3 class="font-bold flex items-center gap-2 text-sm uppercase"><i class="fa-solid fa-user text-blue-400"></i> Tus Datos (Remitente)</h3>
                    <i class="fa-solid fa-chevron-down text-xs"></i>
                </div>
                <div id="acc-personal" class="accordion-content p-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="cv-label">Nombre</label><input type="text" class="cv-input" id="input-name" placeholder="Gurrett" oninput="updateLetter()"></div>
                        <div><label class="cv-label">Apellido</label><input type="text" class="cv-input" id="input-lastname" placeholder="Butler" oninput="updateLetter()"></div>
                    </div>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-2">
                        <div><label class="cv-label">Email</label><input type="email" class="cv-input" id="input-email" placeholder="info@example.com" oninput="updateLetter()"></div>
                        <div><label class="cv-label">Teléfono</label><input type="tel" class="cv-input" id="input-phone" placeholder="+123 456 7890" oninput="updateLetter()"></div>
                    </div>

                    <div class="mt-2">
                        <label class="cv-label">Dirección</label><input type="text" class="cv-input" id="input-address" placeholder="Herengracht 458" oninput="updateLetter()">
                    </div>
                    <div class="grid grid-cols-2 gap-4 mt-2">
                        <div><label class="cv-label">Ciudad</label><input type="text" class="cv-input" id="input-city" placeholder="Amsterdam" oninput="updateLetter()"></div>
                        <div><label class="cv-label">Código Postal</label><input type="text" class="cv-input" id="input-zip" placeholder="1017CA" oninput="updateLetter()"></div>
                    </div>
                </div>
            </div>

            <div class="mb-4 border border-white/10 rounded-lg overflow-hidden bg-black/20">
                <div class="accordion-header bg-white/5 p-4 flex justify-between items-center" onclick="toggleAccordion('acc-recipient')">
                    <h3 class="font-bold flex items-center gap-2 text-sm uppercase"><i class="fa-solid fa-building text-green-400"></i> Datos del Destinatario</h3>
                    <i class="fa-solid fa-chevron-down text-xs"></i>
                </div>
                <div id="acc-recipient" class="accordion-content p-4">
                    <label class="cv-label">Empresa / Organización</label>
                    <input type="text" class="cv-input" id="input-rec-company" placeholder="CV Studio33" oninput="updateLetter()">
                    
                    <label class="cv-label">Nombre del Contacto (Reclutador)</label>
                    <input type="text" class="cv-input" id="input-rec-name" placeholder="Miranda Smith" oninput="updateLetter()">
                    
                    <label class="cv-label">Dirección Empresa</label>
                    <input type="text" class="cv-input" id="input-rec-address" placeholder="Piet Heinkade 221" oninput="updateLetter()">
                    
                    <label class="cv-label">Ciudad / Estado / CP</label>
                    <input type="text" class="cv-input" id="input-rec-city" placeholder="London, LC 11122" oninput="updateLetter()">
                </div>
            </div>

            <div class="mb-4 border border-white/10 rounded-lg overflow-hidden bg-black/20">
                <div class="accordion-header bg-white/5 p-4 flex justify-between items-center" onclick="toggleAccordion('acc-config')">
                    <h3 class="font-bold flex items-center gap-2 text-sm uppercase"><i class="fa-solid fa-calendar-days text-purple-400"></i> Configuración Carta</h3>
                    <i class="fa-solid fa-chevron-down text-xs"></i>
                </div>
                <div id="acc-config" class="accordion-content p-4">
                    <label class="cv-label">Fecha</label>
                    <input type="date" class="cv-input" id="input-letter-date" oninput="updateLetter()">
                    
                    <label class="cv-label">Saludo Inicial</label>
                    <input type="text" class="cv-input" id="input-salutation" placeholder="Dear Ms. Smith," oninput="updateLetter()">

                    <label class="cv-label">Despedida</label>
                    <input type="text" class="cv-input" id="input-closing" placeholder="Sincerely," oninput="updateLetter()">
                </div>
            </div>

            <div class="mb-4 border border-white/10 rounded-lg overflow-hidden bg-black/20">
                <div class="accordion-header bg-white/5 p-4 flex justify-between items-center" onclick="toggleAccordion('acc-body')">
                    <h3 class="font-bold flex items-center gap-2 text-sm uppercase"><i class="fa-solid fa-align-left text-yellow-400"></i> Cuerpo de la Carta</h3>
                    <i class="fa-solid fa-chevron-down text-xs"></i>
                </div>
                <div id="acc-body" class="accordion-content p-4">
                    <div class="relative">
                        <textarea class="cv-input h-96 text-sm" id="input-letter-body" placeholder="Escribe aquí el cuerpo de tu carta..." oninput="updateLetter()"></textarea>
                        
                        <button id="btn-ai-body" class="absolute bottom-2 right-2 text-xs bg-purple-600 hover:bg-purple-500 text-white px-3 py-1 rounded transition flex items-center gap-1 shadow-lg" onclick="improveTextAI('input-letter-body', 'btn-ai-body')">
                            <i class="fa-solid fa-wand-magic-sparkles"></i> Mejorar con IA
                        </button>
                    </div>
                    <p class="warning-text">Usa doble Enter para separar párrafos.</p>
                </div>
            </div>

        </div>

        <div class="hidden md:flex w-1/2 lg:w-7/12 bg-gray-800 justify-center overflow-y-auto relative no-print p-8 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]">
            <div class="scale-90 origin-top transition-transform duration-300" id="preview-wrapper"> 
                
                <div id="letter-preview" class="hoja-a4">
                    <header class="letter-header">
                        <div class="header-name" id="display-header-name">GURRETT BUTLER</div>
                        <div class="header-contact">
                            <div class="contact-col">
                                <div class="label">ADDRESS</div>
                                <div class="value" id="display-address-line1">HERENGRACHT 458</div>
                                <div class="value" id="display-address-line2">AMSTERDAM, 1017CA</div>
                                
                                <div class="label">EMAIL</div>
                                <div class="value" id="display-email-header">INFO@EXAMPLE.COM</div>
                            </div>
                            <div class="contact-col">
                                <div class="label">PHONE NUMBER</div>
                                <div class="value" id="display-phone-header">+123 456 7890</div>
                            </div>
                        </div>
                    </header>
            
                    <hr class="letter-hr">
            
                    <div class="recipient-info">
                        <strong id="display-rec-company">CV Studio33</strong>
                        <span id="display-rec-name">Miranda Smith</span><br>
                        <span id="display-rec-address">Piet Heinkade 221</span><br>
                        <span id="display-rec-city">London, LC 11122</span>
                    </div>
            
                    <div class="letter-date" id="display-date">Amsterdam, 19 September 2022</div>
            
                    <div class="salutation" id="display-salutation">Dear Ms. Smith,</div>
            
                    <div class="letter-content" id="display-body">
I am interested in the author’s assistant position at Acme Company, as advertised on LinkedIn. I am currently employed as legislative director for Assemblywoman Nora Kiel, Chairperson of the NYS Assembly. I believe that the skills and experiences I have gained at this position make me an ideal candidate for the job of author’s assistant.

As legislative director, I have developed strong writing and editing skills. For example, one of my main duties is to prepare Assemblywoman Nora Kiel’s personal legislation, which deals with issues related to her position as Senior Member of the NYS Assembly Standing Committee.

This duty requires meticulous writing and editing skills, and an ability to convey complex legal ideas clearly. I have prepared dozens of pieces of legislation and received praise for the clarity of my writing.
                    </div>
            
                    <div class="closing" id="display-closing">Sincerely,</div>
                    <div class="signature" id="display-sign-name">Gurrett Butler</div>
            
                    <footer class="letter-footer">
                        <span id="display-footer-name">Gurrett Butler</span>
                        <span id="display-phone-footer">+123 456 7890</span>
                        <span id="display-email-footer">info@example.com</span>
                    </footer>
                </div>
                </div>
        </div>

    </div>

    <div class="fixed bottom-6 right-6 md:hidden z-50 no-print">
        <button onclick="toggleMobileModal()" class="bg-blue-600 hover:bg-blue-500 text-white rounded-full p-4 shadow-2xl animate-bounce">
            <i class="fa-solid fa-eye text-xl"></i>
        </button>
    </div>

    <div id="mobile-modal" class="mobile-preview-modal no-print">
        <div class="p-4">
            <button onclick="toggleMobileModal()" class="fixed top-4 right-4 bg-red-600 text-white p-2 rounded-full z-50 shadow-lg">
                <i class="fa-solid fa-xmark"></i>
            </button>
            <div class="flex justify-center min-h-screen pt-12 pb-20">
                <div id="mobile-cv-clone-container" class="origin-top scale-[0.45] sm:scale-75 shadow-2xl"></div>
            </div>
        </div>
    </div>

    <script>
        // --- INICIALIZACIÓN ---
        window.onload = function() {
            // Cargar datos predeterminados en inputs para que no esté vacío
            const defaultBody = "I am interested in the author’s assistant position at Acme Company, as advertised on LinkedIn. I am currently employed as legislative director for Assemblywoman Nora Kiel, Chairperson of the NYS Assembly. I believe that the skills and experiences I have gained at this position make me an ideal candidate for the job of author’s assistant.\n\nAs legislative director, I have developed strong writing and editing skills. For example, one of my main duties is to prepare Assemblywoman Nora Kiel’s personal legislation, which deals with issues related to her position as Senior Member of the NYS Assembly Standing Committee.\n\nThis duty requires meticulous writing and editing skills, and an ability to convey complex legal ideas clearly. I have prepared dozens of pieces of legislation and received praise for the clarity of my writing.";
            
            if(!localStorage.getItem('letterDataStudio33')) {
               document.getElementById('input-letter-body').value = defaultBody;
            }

            loadData();
            updateLetter();
            updateDesign(); // Aplicar diseño inicial
        };

        // --- GESTIÓN DE DATOS ---
        function saveData() {
            const data = {
                // Remitente
                name: val('input-name'),
                lastname: val('input-lastname'),
                email: val('input-email'),
                phone: val('input-phone'),
                address: val('input-address'),
                city: val('input-city'),
                zip: val('input-zip'),
                // Destinatario
                recCompany: val('input-rec-company'),
                recName: val('input-rec-name'),
                recAddress: val('input-rec-address'),
                recCity: val('input-rec-city'),
                // Config
                date: val('input-letter-date'),
                salutation: val('input-salutation'),
                closing: val('input-closing'),
                // Body
                body: val('input-letter-body'),
                // Design
                fontHeader: val('font-header'),
                fontBody: val('font-body'),
                fontSize: val('font-size-body')
            };
            localStorage.setItem('letterDataStudio33', JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem('letterDataStudio33');
            if(saved) {
                const data = JSON.parse(saved);
                if(data.name) document.getElementById('input-name').value = data.name;
                if(data.lastname) document.getElementById('input-lastname').value = data.lastname;
                if(data.email) document.getElementById('input-email').value = data.email;
                if(data.phone) document.getElementById('input-phone').value = data.phone;
                if(data.address) document.getElementById('input-address').value = data.address;
                if(data.city) document.getElementById('input-city').value = data.city;
                if(data.zip) document.getElementById('input-zip').value = data.zip;
                
                if(data.recCompany) document.getElementById('input-rec-company').value = data.recCompany;
                if(data.recName) document.getElementById('input-rec-name').value = data.recName;
                if(data.recAddress) document.getElementById('input-rec-address').value = data.recAddress;
                if(data.recCity) document.getElementById('input-rec-city').value = data.recCity;

                if(data.date) document.getElementById('input-letter-date').value = data.date;
                if(data.salutation) document.getElementById('input-salutation').value = data.salutation;
                if(data.closing) document.getElementById('input-closing').value = data.closing;
                if(data.body) document.getElementById('input-letter-body').value = data.body;
                
                // Cargar Diseño
                if(data.fontHeader) document.getElementById('font-header').value = data.fontHeader;
                if(data.fontBody) document.getElementById('font-body').value = data.fontBody;
                if(data.fontSize) document.getElementById('font-size-body').value = data.fontSize;
            }
        }

        // --- ACTUALIZAR DISEÑO (TIPOGRAFÍA) ---
        function updateDesign() {
            saveData();
            const headerFont = document.getElementById('font-header').value;
            const bodyFont = document.getElementById('font-body').value;
            const bodySize = document.getElementById('font-size-body').value;

            // Aplicar al Header y Nombres
            document.querySelector('.letter-header').style.fontFamily = headerFont;
            document.getElementById('display-header-name').style.fontFamily = headerFont;
            document.getElementById('display-sign-name').style.fontFamily = headerFont;

            // Aplicar al Cuerpo
            document.getElementById('letter-preview').style.fontFamily = bodyFont; // Base
            document.getElementById('display-body').style.fontFamily = bodyFont;
            document.getElementById('display-body').style.fontSize = bodySize + 'pt';
            
            // Actualizar label del slider
            document.getElementById('font-size-val').innerText = bodySize + 'pt';
        }

        // --- LÓGICA DE ACTUALIZACIÓN CONTENIDO ---
        function updateLetter() {
            saveData(); 

            // REMITENTE
            const name = val('input-name') || 'GURRETT';
            const lastname = val('input-lastname') || 'BUTLER';
            const fullname = `${name} ${lastname}`;
            
            txt('display-header-name', fullname);
            txt('display-sign-name', fullname); // Firma
            txt('display-footer-name', fullname); // Footer

            const address = val('input-address') || 'HERENGRACHT 458';
            const city = val('input-city') || 'AMSTERDAM';
            const zip = val('input-zip') || '1017CA';
            
            txt('display-address-line1', address.toUpperCase());
            txt('display-address-line2', `${city}, ${zip}`.toUpperCase());

            const email = val('input-email') || 'INFO@EXAMPLE.COM';
            txt('display-email-header', email.toUpperCase());
            txt('display-email-footer', email);

            const phone = val('input-phone') || '+123 456 7890';
            txt('display-phone-header', phone);
            txt('display-phone-footer', phone);

            // DESTINATARIO
            txt('display-rec-company', val('input-rec-company') || 'CV Studio33');
            txt('display-rec-name', val('input-rec-name') || 'Miranda Smith');
            txt('display-rec-address', val('input-rec-address') || 'Piet Heinkade 221');
            txt('display-rec-city', val('input-rec-city') || 'London, LC 11122');

            // CONFIG (FECHA)
            const dateInput = val('input-letter-date');
            if (dateInput) {
                // Formatear fecha: YYYY-MM-DD -> 3 de Febrero de 2026
                const dateObj = new Date(dateInput);
                // Ajuste de zona horaria simple para que no atrase un día
                const userTimezoneOffset = dateObj.getTimezoneOffset() * 60000;
                const adjustedDate = new Date(dateObj.getTime() + userTimezoneOffset);
                
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                txt('display-date', adjustedDate.toLocaleDateString('es-ES', options));
            } else {
                txt('display-date', 'Amsterdam, 19 September 2022');
            }

            txt('display-salutation', val('input-salutation') || 'Dear Ms. Smith,');
            txt('display-closing', val('input-closing') || 'Sincerely,');

            // BODY
            const bodyText = val('input-letter-body');
            txt('display-body', bodyText);
        }

        function val(id) { return document.getElementById(id) ? document.getElementById(id).value : ''; }
        function txt(id, text) { if(document.getElementById(id)) document.getElementById(id).innerText = text; }

        function toggleAccordion(id) {
            document.getElementById(id).classList.toggle('active');
        }

        // --- IA SIN KEY / SIN CORS ---
        async function improveTextAI(inputId, btnId) {
            const input = document.getElementById(inputId);
            const btn = document.getElementById(btnId);
            const original = input.value;
            
            if(!original) return alert("Escribe algo primero.");
            if(original.length < 10) return alert("Texto muy corto.");

            const originalBtnText = btn.innerHTML;
            btn.innerHTML = `<i class="fa-solid fa-spinner ai-loading"></i>`;
            btn.disabled = true;

            try {
                // Prompt optimizado para evitar basura en la respuesta
                const systemPrompt = "Act as an expert HR copywriter. Rewrite the following cover letter text to be professional, persuasive, and concise in Spanish. Do NOT use markdown, quotes, asterisks, or introductory phrases. Return ONLY the rewritten text.";
                const fullPrompt = `${systemPrompt} Text: ${original}`;
                
                const response = await fetch(`https://text.pollinations.ai/${encodeURIComponent(fullPrompt)}`);
                
                if (!response.ok) throw new Error('Error API');
                
                let improvedText = await response.text();
                // Limpieza extra por seguridad
                improvedText = improvedText.replace(/^"|"$/g, '').replace(/\*\*/g, '').trim();
                
                input.value = improvedText;
                updateLetter();
            } catch (error) {
                alert("Error al conectar con la IA. Intenta de nuevo.");
                console.error(error);
            } finally {
                btn.innerHTML = originalBtnText;
                btn.disabled = false;
            }
        }

        function downloadPDFDirect() {
            const element = document.getElementById('letter-preview');
            const opt = {
                margin:       0,
                filename:     'mi-carta-presentacion.pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2, useCORS: true, scrollY: 0 },
                jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().set(opt).from(element).save();
        }

        function toggleMobileModal() {
            const modal = document.getElementById('mobile-modal');
            const container = document.getElementById('mobile-cv-clone-container');
            const original = document.getElementById('letter-preview');
            if (modal.classList.contains('active')) { modal.classList.remove('active'); container.innerHTML = ''; } 
            else { modal.classList.add('active'); const clone = original.cloneNode(true); clone.style.margin = '0'; clone.style.transform = 'scale(1)'; container.appendChild(clone); }
        }
    </script>
</body>
</html>